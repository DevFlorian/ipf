
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2018-04-20
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>DICOM audit support | ipf-commons-audit</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/docs.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="https://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
	</head>

	<body class="page-index project-ipf-commons-audit" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=".."><span class="color-highlight">IPF</span> Open eHealth Integration Platform</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a></li>
							<li ><a href="https://github.com/oehf/ipf" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a></li>
									<li ><a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="http://oehf.github.io/ipf" id="bannerLeft"><h1><br/><span class="color-highlight">IPF</span> Open eHealth Integration Platform</h1></a>
					<p class="lead">eHealth standards on steroids</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="DICOM_audit_support">DICOM audit support</h2>
 </div> 
 <p>The <tt>ipf-commons-audit</tt> module contains a reimplementation and improvement of the ATNA functionality contained in the <tt>ipf-oht-atna-*</tt> modules that originate from the Eclipse OpenHealthTools project. This includes building <a class="externalLink" href="https://dicom.nema.org/medical/dicom/current/output/html/part15.html#sect_A.5">DICOM</a>/<a class="externalLink" href="http://ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2a.pdf">ATNA</a>-compliant Audit Records as well as queueing and sending them to an Audit Repository.</p> 
 <p>The most important improvements are:</p> 
 <ul> 
  <li>type-safe Audit Event builders, that enforce setting mandatory members and avoid setting coded values into the wrong places (e.g. accidentally setting a <tt>ParticipantObjectTypeCodeRole</tt> code as <tt>ParticipantObjectTypeCode</tt> code).</li> 
  <li>possibility to select an Audit Message XML schema that belongs to a specific <a class="externalLink" href="https://dicom.nema.org/medical/dicom/current/output/html/part15.html#sect_A.5">DICOM</a> version</li> 
  <li>possibility to plug-in your own exception handler in case the Audit Repository is not reachable</li> 
  <li>configuration is done via an <tt>AuditContext</tt> bean instead of a static global class. You can create and use as many <tt>AuditContext</tt> configuration beans as you wish.</li> 
 </ul> 
 <div class="section"> 
  <h3 id="Constructing_an_Audit_Message">Constructing an Audit Message</h3> 
  <p>All of the IHE components implemented by IPF automatically use the audit support of this module for ATNA auditing. You only need to configure an <a href="../apidocs/org/openehealth/ipf/commons/audit/AuditContext.html">AuditContext</a> bean. When you use one of the Spring Boot starter modules, this bean is already provided for you. </p> 
  <p>In order to create and submit your own Audit Message, perform the following steps</p> 
  <ol style="list-style-type: decimal"> 
   <li>Construct your Audit Message by using one of the builder classes contained in the <tt>org.openehealth.ipf.commons.audit.event</tt> package. Note that the IHE modules (such as <tt>ipf-commons-ihe-core</tt> or <tt>ipf-commons-ihe-xds</tt>) inherit from some of these builders to create IHE-style ATNA-compliant Audit messages more easily.</li> 
   <li>Call the <tt>getMessage</tt> or <tt>getMessages</tt> method to obtain the <tt>AuditMessage</tt> from the builder.</li> 
   <li>Submit the Audit Message to the configured destination by calling <tt>AuditContext#audit(AuditMessage...)</tt> method.</li> 
  </ol> 
  <p>Every Audit Message and Audit Message builder also has a <tt>validate</tt> method that check basic restrictions defined by DICOM or IHE.</p> 
  <p>The <tt>AuditMessageBuilder</tt> implementations are modelled corresponding to the definitions of the <a class="externalLink" href="http://dicom.nema.org/medical/dicom/current/output/html/part15.html#sect_A.5.3">DICOM Specific Audit Messages</a>.</p> 
  <p>The delegate builder class <tt>IHEAuditMessageBuilder</tt> has builder sub classes that correspond with the IHE <a class="externalLink" href="http://ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2a.pdf">ITI specification, Volume 2a</a>, section 3.20.4.1. </p> 
  <p>The DICOM serialization strategies produce XML files that validate against the schema of the respective revision of the <a class="externalLink" href="http://dicom.nema.org/medical/dicom/current/output/html/part15.html#sect_A.5.1">DICOM Audit Message Schema</a>.</p> 
  <p>For more details on the API, please study the <a href="../apidocs/org/openehealth/ipf/commons/audit/package-frame.html">javadocs</a>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Example">Example</h3> 
  <p>Auditing an application start event</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>auditContext.audit(
    new ApplicationActivityBuilder.ApplicationStart(EventOutcomeIndicator.Success)
        .setAuditSource(auditContext)
        .setApplicationParticipant(
                appName,
                null,
                appName,
                AuditUtils.getLocalHostName())
        .addApplicationStarterParticipant(System.getProperty(&quot;user.name&quot;))
        .getMessage()
);
</pre> 
   </div> 
  </div> 
  <p>Auditing a change to a user account:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>auditContext.audit(
new SecurityAlertBuilder(EventOutcomeIndicator.Success, null, EventTypeCode.UserSecurityAttributesChanged)
                .addActiveParticipant(adminUserId, null, adminUserName, true, null, networkId)
                .addParticipantObjectIdentification(
                        ParticipantObjectIdTypeCode.UserIdentifier,
                        targetUserName,
                        null,
                        null,
                        targetUserId,
                        ParticipantObjectTypeCode.Person,
                        ParticipantObjectTypeCodeRole.User,
                        null, null)
                .getMessage()
);
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Hints">Hints</h3> 
  <ul> 
   <li>The <tt>org.openehealth.ipf.commons.audit.utils.AuditUtils</tt> class contains static methods to obtain runtime information like process ID, current user, local host and IP address.</li> 
  </ul> 
 </div> 
 <div class="section"> 
  <h3 id="Configuration">Configuration</h3> 
  <p>The <tt>AuditContext</tt> interface (and its <a href="../apidocs/org/openehealth/ipf/commons/audit/DefaultAuditContext.html">DefaultAuditContext</a> implementation) is the only place to configure static details for auditing, e.g. whether auditing is activated, the location of the Audit Repository, or the transmission protocol. It also allows to setup strategies for serialization, whether to send synchronously or asynchronously, and how errors are handled.</p> 
  <div class="section"> 
   <h4 id="Generic_properties">Generic properties</h4> 
   <table border="0" class="bodyTable table table-striped table-hover"> 
    <thead> 
     <tr class="a"> 
      <th>Property </th> 
      <th>Default </th> 
      <th>Description </th> 
     </tr> 
    </thead> 
    <tbody> 
     <tr class="b"> 
      <td><tt>auditEnabled</tt> </td> 
      <td>false </td> 
      <td>Whether audit is sent to the repository or not</td> 
     </tr> 
     <tr class="a"> 
      <td><tt>auditRepositoryHost</tt> </td> 
      <td>localhost </td> 
      <td>Host name of the audit repository where audit records are sent to</td> 
     </tr> 
     <tr class="b"> 
      <td><tt>auditRepositoryPort</tt> </td> 
      <td>514 </td> 
      <td>Port of the the audit repository where audit records are sent to</td> 
     </tr> 
     <tr class="a"> 
      <td><tt>auditRepositoryTransport</tt> </td> 
      <td>UDP </td> 
      <td>Transport protocol. One of UDP, TLS. Experimental: NIO-TLS (requires Vert.x lib dependency)</td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div class="section"> 
   <h4 id="Content_properties">Content properties</h4> 
   <table border="0" class="bodyTable table table-striped table-hover"> 
    <thead> 
     <tr class="a"> 
      <th>Property </th> 
      <th>Default </th> 
      <th>Description </th> 
     </tr> 
    </thead> 
    <tbody> 
     <tr class="b"> 
      <td><tt>sendingApplication</tt> </td> 
      <td>IPF </td> 
      <td>sending application for the Syslog header info</td> 
     </tr> 
     <tr class="a"> 
      <td><tt>auditSourceId</tt> </td> 
      <td>IPF </td> 
      <td>audit source ID for the source identification of the audit message</td> 
     </tr> 
     <tr class="b"> 
      <td><tt>auditEnterpriseSiteId</tt> </td> 
      <td>IPF </td> 
      <td>audit enterprise site ID for the source identification of the audit message</td> 
     </tr> 
     <tr class="a"> 
      <td><tt>auditSource</tt> </td> 
      <td>9 (Other) </td> 
      <td>audit source type for the source identification of the audit message</td> 
     </tr> 
     <tr class="b"> 
      <td><tt>includeParticipantsFromResponse</tt> </td> 
      <td>false </td> 
      <td>whether to include participant objects from a response into the audit message</td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div class="section"> 
   <h4 id="Advanced_properties">Advanced properties</h4> 
   <table border="0" class="bodyTable table table-striped table-hover"> 
    <thead> 
     <tr class="a"> 
      <th>Property </th> 
      <th>Default </th> 
      <th>Description </th> 
     </tr> 
    </thead> 
    <tbody> 
     <tr class="b"> 
      <td><tt>auditTransmissionProtocol</tt> </td> 
      <td>instance of <tt>UDPSyslogSenderImpl</tt> </td> 
      <td>Transport implementation. Overrules <tt>auditRepositoryTransport</tt></td> 
     </tr> 
     <tr class="a"> 
      <td><tt>auditMessageQueue</tt> </td> 
      <td>instance of <tt>SynchronousAuditMessageQueue</tt></td> 
      <td>Audit message dispatcher implementation</td> 
     </tr> 
     <tr class="b"> 
      <td><tt>serializationStrategy</tt> </td> 
      <td>instance of <tt>Current</tt> (i.e. DICOM2017c) </td> 
      <td>Serialization implementation</td> 
     </tr> 
     <tr class="a"> 
      <td><tt>auditMessagePostProcessor</tt> </td> 
      <td>no-op </td> 
      <td>Audit Message Postprocessing, called before audit message is dispatched</td> 
     </tr> 
     <tr class="b"> 
      <td><tt>auditExceptionHandler</tt> </td> 
      <td>instance of <tt>LoggingAuditExceptionHandler</tt></td> 
      <td>Handler to be called if the delivery of audit message to the audit repository has failed</td> 
     </tr> 
    </tbody> 
   </table> 
   <p>The default setup is to send Audit Messages via UDP to localhost:514, and handle delivery errors by just logging them. For production usage, it is usually required to configure a TLS connection to a remote Audit Repository and some decent strategy for handling failed connections to the Audit Repository.</p> 
  </div> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#DICOM_audit_support" title="DICOM audit support">DICOM audit support <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Constructing_an_Audit_Message" title="Constructing an Audit Message">Constructing an Audit Message</a>
		<li><a href="#Example" title="Example">Example</a>
		<li><a href="#Hints" title="Hints">Hints</a>
		<li class="dropdown"><a href="#Configuration" title="Configuration">Configuration <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Generic_properties" title="Generic properties">Generic properties</a>
		<li><a href="#Content_properties" title="Content properties">Content properties</a>
		<li><a href="#Advanced_properties" title="Advanced properties">Advanced properties</a>
				<li class="divider"></li>
			</ul>
		</li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release notes">Release notes</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li >
							<a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li class="nav-header">Submodules</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a>
						</li>
						<li >
							<a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li class="active">
							<a href="#" title="About">About</a>
						</li>
						<li >
							<a href="project-summary.html" title="Summary">Summary</a>
						</li>
						<li >
							<a href="team-list.html" title="Team">Team</a>
						</li>
						<li >
							<a href="license.html" title="Licenses">Licenses</a>
						</li>
						<li >
							<a href="mail-lists.html" title="Mailing Lists">Mailing Lists</a>
						</li>
						<li >
							<a href="source-repository.html" title="Source Code Management">Source Code Management</a>
						</li>
							</ul>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2018 <a href="http://www.openehealth.org/">Open eHealth Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.5-SNAPSHOT. </span><span class="publishDate">Last Published: 2018-04-20. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>
	<script src="https://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
